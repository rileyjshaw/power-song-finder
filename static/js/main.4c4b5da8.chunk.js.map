{"version":3,"sources":["hooks.js","App.js","reportWebVitals.js","index.js"],"names":["useKeyPresses","keyHandlers","useState","keysPressed","setKeysPressed","useEffect","downHandler","key","handlers","oldKeysPressed","onDown","upHandler","onUp","window","addEventListener","removeEventListener","useRepeatable","fn","delay","interval","maxRepeats","timeout","useRef","repeatCount","loopingFn","useCallback","e","current","setTimeout","onPress","onRelease","clearTimeout","SPOTIFY_API_ROUTE","SPOTIFY_AUTH_URL","encodeURIComponent","join","boundTempo","tempo","Math","max","min","PlayIcon","version","xmlns","xmlnsXlink","viewBox","points","PauseIcon","x","y","width","height","steps","title","Main","className","href","target","rel","Footer","targetTempo","setTargetTempo","preventDefault","t","incrementPress","incrementRelease","decrementPress","decrementRelease","useMemo","ArrowUp","ArrowRight","ArrowDown","ArrowLeft","onMouseDown","onMouseUp","onTouchStart","onTouchCancel","onTouchEnd","setStep","onClick","s","tracks","scope","map","track","scaledBpm","bpm","bestError","i","factor","doubledBpm","doubledError","halvedBpm","halvedError","compareErrors","error","sort","a","b","url","artist","duration","round","sign","parseFloat","abs","toFixed","Mp3Toggle","preview","isPlaying","setIsPlaying","Audio","preload","src","togglePlaying","paused","ended","play","pause","App","queryParams","access_token","step","_setTargetTempo","setTracks","document","documentElement","style","setProperty","newTempo","oldTempo","Authorization","token_type","nextParams","processResponse","next","items","slice","indexOf","forEach","fetch","id","headers","then","response","json","features","oldTracks","name","artists","ms","duration_ms","floor","padStart","preview_url","external_urls","spotify","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","location","hash","split","reduce","acc","pair","value","decodeURIComponent","history","replaceState","pathname","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.4c4b5da8.chunk.js","sourcesContent":["import { useCallback, useEffect, useRef, useState } from 'react';\n\nexport function useKeyPresses(keyHandlers) {\n\tconst [keysPressed, setKeysPressed] = useState({});\n\n\tuseEffect(() => {\n\t\tfunction downHandler({ key }) {\n\t\t\tconst handlers = keyHandlers[key];\n\t\t\tif (handlers && !keysPressed[key]) {\n\t\t\t\tsetKeysPressed(oldKeysPressed => ({\n\t\t\t\t\t...oldKeysPressed,\n\t\t\t\t\t[key]: true,\n\t\t\t\t}));\n\t\t\t\thandlers.onDown?.();\n\t\t\t}\n\t\t}\n\n\t\tfunction upHandler({ key }) {\n\t\t\tconst handlers = keyHandlers[key];\n\t\t\tif (handlers && keysPressed[key]) {\n\t\t\t\tsetKeysPressed(oldKeysPressed => ({\n\t\t\t\t\t...oldKeysPressed,\n\t\t\t\t\t[key]: false,\n\t\t\t\t}));\n\t\t\t\thandlers.onUp?.();\n\t\t\t}\n\t\t}\n\n\t\twindow.addEventListener('keydown', downHandler);\n\t\twindow.addEventListener('keyup', upHandler);\n\t\treturn () => {\n\t\t\twindow.removeEventListener('keydown', downHandler);\n\t\t\twindow.removeEventListener('keyup', upHandler);\n\t\t};\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [keyHandlers]);\n\n\treturn keysPressed;\n}\n\nexport function useRepeatable(fn, { delay = 500, interval = 20, maxRepeats = 0 } = {}) {\n\tconst timeout = useRef(null);\n\tconst repeatCount = useRef(0);\n\n\tconst loopingFn = useCallback(\n\t\te => {\n\t\t\tfn(e);\n\t\t\tif (!maxRepeats || ++repeatCount.current < maxRepeats) {\n\t\t\t\ttimeout.current = setTimeout(loopingFn, interval);\n\t\t\t}\n\t\t},\n\t\t[fn, interval, maxRepeats]\n\t);\n\n\tconst onPress = useCallback(\n\t\te => {\n\t\t\tif (timeout.current) return;\n\t\t\ttimeout.current = setTimeout(loopingFn, delay, e);\n\t\t},\n\t\t[loopingFn, delay]\n\t);\n\n\tconst onRelease = useCallback(\n\t\te => {\n\t\t\tclearTimeout(timeout.current);\n\t\t\ttimeout.current = null;\n\t\t\tif (!maxRepeats || repeatCount.current < maxRepeats) fn(e);\n\t\t\trepeatCount.current = 0;\n\t\t},\n\t\t[fn, maxRepeats]\n\t);\n\n\treturn [onPress, onRelease];\n}\n","import React, { useCallback, useState, useEffect, useMemo } from 'react';\nimport { useKeyPresses, useRepeatable } from './hooks';\nimport './App.css';\n\nconst SPOTIFY_API_ROUTE = process.env.NODE_ENV === 'development' ? '' : 'https://api.spotify.com';\nconst SPOTIFY_REDIRECT_URI =\n\tprocess.env.NODE_ENV === 'development' ? 'http://localhost:3000/' : 'https://rileyjshaw.com/power-song-finder/';\nconst SPOTIFY_CLIENT_ID = 'a6babd5bf4654f2998b1afa67c1866cf';\nconst SPOTIFY_SCOPES = ['user-top-read', 'user-read-email'];\nconst SPOTIFY_SHOW_DIALOG = false;\n// TODO: Make this random and check it. See https://developer.spotify.com/documentation/general/guides/authorization-guide/#implicit-grant-flow\nconst SPOTIFY_STATE = 'POWER_SONG';\nconst SPOTIFY_AUTH_URL = `https://accounts.spotify.com/authorize?client_id=${SPOTIFY_CLIENT_ID}&response_type=token&redirect_uri=${SPOTIFY_REDIRECT_URI}&scope=${encodeURIComponent(\n\tSPOTIFY_SCOPES.join(' ')\n)}&state=${SPOTIFY_STATE}&show_dialog=${SPOTIFY_SHOW_DIALOG}`;\n\nconst TEMPO_LOWER_BOUND = 60;\nconst TEMPO_UPPER_BOUND = 240;\nconst boundTempo = tempo => Math.max(TEMPO_LOWER_BOUND, Math.min(TEMPO_UPPER_BOUND, tempo));\nconst msToTimestamp = ms => `${Math.floor(ms / 60000)}:${`${Math.floor(ms / 1000) % 60}`.padStart(2, 0)}`;\n\nconst PlayIcon = () => (\n\t<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlnsXlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 100 100\">\n\t\t<polygon points=\"20,10 20,90 80,50\" />\n\t</svg>\n);\nconst PauseIcon = () => (\n\t<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlnsXlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 100 100\">\n\t\t<rect x=\"20\" y=\"25\" width=\"20\" height=\"50\" />\n\t\t<rect x=\"52\" y=\"25\" width=\"20\" height=\"50\" />\n\t</svg>\n);\n\nconst steps = [\n\t{\n\t\ttitle: 'Find your Power Song',\n\t\tMain: IntroDescription,\n\t\tFooter: () => (\n\t\t\t<p>\n\t\t\t\tTo get started, <a href={SPOTIFY_AUTH_URL}>log in with Spotify</a>.\n\t\t\t</p>\n\t\t),\n\t},\n\t{\n\t\ttitle: 'Set your target cadence',\n\t\tMain: SelectTempo,\n\t\tFooter: ({ setStep }) => (\n\t\t\t<p>\n\t\t\t\tOnce you’ve chosen a cadence,{' '}\n\t\t\t\t<button className=\"Button-link\" onClick={() => setStep(s => s + 1)}>\n\t\t\t\t\tpick your Power Song\n\t\t\t\t</button>\n\t\t\t\t.\n\t\t\t</p>\n\t\t),\n\t},\n\t{\n\t\ttitle: 'Pick your Power Song',\n\t\tMain: SelectSong,\n\t\tFooter: ({ setStep }) => (\n\t\t\t<p>\n\t\t\t\tOr,{' '}\n\t\t\t\t<button className=\"Button-link\" onClick={() => setStep(s => Math.max(0, s - 1))}>\n\t\t\t\t\ttry another cadence\n\t\t\t\t</button>\n\t\t\t\t.\n\t\t\t</p>\n\t\t),\n\t},\n];\n\nfunction IntroDescription() {\n\treturn (\n\t\t<div className=\"Intro\">\n\t\t\t<p className=\"unitalic\">\n\t\t\t\tThis application searches your favorite Spotify tracks for a running “Power Song”. A Power Song matches your\n\t\t\t\ttarget cadence, and pumps you up during a tough point in the run.\n\t\t\t</p>\n\t\t\t<blockquote>\n\t\t\t\t<p>\n\t\t\t\t\tIn carefully controlled experiments, adding a soundtrack helps rowers, sprinters, and swimmers shave seconds\n\t\t\t\t\toff their times. Runners can tolerate extreme heat and humidity longer, and triathletes can push themselves\n\t\t\t\t\tfarther before reaching exhaustion. Moving to music even leads athletes to consume less oxygen as they exert\n\t\t\t\t\tthemselves, as if the song itself supplies some of the energy they need. Findings like this led the authors of\n\t\t\t\t\ta scientific review in the Annals of Sports Medicine and Research to conclude that music is a legal\n\t\t\t\t\tperformance-enhancing drug.\n\t\t\t\t</p>\n\t\t\t\t<footer>\n\t\t\t\t\t—{' '}\n\t\t\t\t\t<cite>\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\thref=\"https://www.penguinrandomhouse.com/books/564895/the-joy-of-movement-by-kelly-mcgonigal/\"\n\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tKelly McGonigal, <em className=\"unitalic\">“The Joy of Movement”</em>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</cite>\n\t\t\t\t</footer>\n\t\t\t</blockquote>\n\t\t\t<p className=\"unitalic\">\n\t\t\t\tCadence is defined in Beats Per Minute, or “BPM”. Your target BPM corresponds to how many strides you take per\n\t\t\t\tminute. Most recreational runners have a cadence between 150 BPM and 170 BPM, but your cadence is unique to your\n\t\t\t\tneeds and goals as a runner.\n\t\t\t</p>\n\t\t</div>\n\t);\n}\n\nfunction SelectTempo({ targetTempo, setTargetTempo }) {\n\tconst [incrementPress, incrementRelease] = useRepeatable(e => {\n\t\tif (e) e.preventDefault();\n\t\tsetTargetTempo(t => t + 1);\n\t});\n\tconst [decrementPress, decrementRelease] = useRepeatable(e => {\n\t\tif (e) e.preventDefault();\n\t\tsetTargetTempo(t => t - 1);\n\t});\n\tconst keyHandlers = useMemo(\n\t\t() => ({\n\t\t\tArrowUp: { onDown: incrementPress, onUp: incrementRelease },\n\t\t\tArrowRight: { onDown: incrementPress, onUp: incrementRelease },\n\t\t\tArrowDown: { onDown: decrementPress, onUp: decrementRelease },\n\t\t\tArrowLeft: { onDown: decrementPress, onUp: decrementRelease },\n\t\t}),\n\t\t[decrementPress, decrementRelease, incrementPress, incrementRelease]\n\t);\n\tuseKeyPresses(keyHandlers);\n\treturn (\n\t\t<div className=\"Tempo-select\">\n\t\t\t<button\n\t\t\t\tonMouseDown={incrementPress}\n\t\t\t\tonMouseUp={incrementRelease}\n\t\t\t\tonTouchStart={incrementPress}\n\t\t\t\tonTouchCancel={incrementRelease}\n\t\t\t\tonTouchEnd={incrementRelease}\n\t\t\t\tclassName=\"Tempo-button\"\n\t\t\t>\n\t\t\t\t▲\n\t\t\t</button>\n\t\t\t<div className=\"Tempo-container\">\n\t\t\t\t<span className=\"Tempo-value\">{targetTempo}</span>\n\t\t\t\t<span className=\"Tempo-bpm\">BPM</span>\n\t\t\t</div>\n\t\t\t<button\n\t\t\t\tonMouseDown={decrementPress}\n\t\t\t\tonMouseUp={decrementRelease}\n\t\t\t\tonTouchStart={decrementPress}\n\t\t\t\tonTouchCancel={decrementRelease}\n\t\t\t\tonTouchEnd={decrementRelease}\n\t\t\t\tclassName=\"Tempo-button\"\n\t\t\t>\n\t\t\t\t▼\n\t\t\t</button>\n\t\t</div>\n\t);\n}\n\nfunction Mp3Toggle({ url }) {\n\tconst [isPlaying, setIsPlaying] = useState(false);\n\tconst track = useMemo(() => {\n\t\tconst track = new Audio();\n\t\ttrack.preload = 'none';\n\t\ttrack.addEventListener('ended', () => setIsPlaying(false));\n\t\treturn track;\n\t}, []);\n\tuseEffect(() => {\n\t\ttrack.src = url;\n\t}, [track, url]);\n\tconst togglePlaying = useCallback(() => {\n\t\tsetIsPlaying(x => !x);\n\t\ttrack.paused || track.ended ? track.play() : track.pause();\n\t}, [track]);\n\n\treturn <button onClick={togglePlaying}>{isPlaying ? <PauseIcon /> : <PlayIcon />}</button>;\n}\n\n// Prefers a lower absolute error. In the case where absolute errors are the same,\n// prefers a slower tempo.\nconst compareErrors = (a, b) => Math.abs(a) - Math.abs(b) || Math.sign(a) - Math.sign(b);\n\nfunction SelectSong({ tracks, targetTempo }) {\n\treturn (\n\t\ttracks && (\n\t\t\t<table>\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th scope=\"col\">Title</th>\n\t\t\t\t\t\t<th scope=\"col\">Artist</th>\n\t\t\t\t\t\t<th scope=\"col\">Duration</th>\n\t\t\t\t\t\t<th scope=\"col\">BPM</th>\n\t\t\t\t\t\t<th scope=\"col\">Error</th>\n\t\t\t\t\t\t<th scope=\"col\">Preview</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody>\n\t\t\t\t\t{tracks\n\t\t\t\t\t\t.map(track => {\n\t\t\t\t\t\t\tlet scaledBpm = track.bpm;\n\t\t\t\t\t\t\tlet bestError = track.bpm - targetTempo;\n\t\t\t\t\t\t\tfor (let i = 1; i <= 3; ++i) {\n\t\t\t\t\t\t\t\tconst factor = 2 ** i;\n\t\t\t\t\t\t\t\tconst doubledBpm = track.bpm * factor;\n\t\t\t\t\t\t\t\tconst doubledError = doubledBpm - targetTempo;\n\t\t\t\t\t\t\t\tconst halvedBpm = track.bpm / factor;\n\t\t\t\t\t\t\t\tconst halvedError = halvedBpm - targetTempo;\n\t\t\t\t\t\t\t\tif (compareErrors(halvedError, bestError) < 0) {\n\t\t\t\t\t\t\t\t\tscaledBpm = halvedBpm;\n\t\t\t\t\t\t\t\t\tbestError = halvedError;\n\t\t\t\t\t\t\t\t} else if (compareErrors(doubledError, bestError) < 0) {\n\t\t\t\t\t\t\t\t\tscaledBpm = doubledBpm;\n\t\t\t\t\t\t\t\t\tbestError = doubledError;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t...track,\n\t\t\t\t\t\t\t\tbpm: scaledBpm,\n\t\t\t\t\t\t\t\terror: bestError,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.sort((a, b) => compareErrors(a.error, b.error))\n\t\t\t\t\t\t.map(track => (\n\t\t\t\t\t\t\t<tr key={`${track.title}|${track.artist}`}>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<a href={track.url} target=\"_blank\" rel=\"noopener noreferrer\">\n\t\t\t\t\t\t\t\t\t\t{track.title}\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td>{track.artist}</td>\n\t\t\t\t\t\t\t\t<td>{track.duration}</td>\n\t\t\t\t\t\t\t\t<td>{Math.round(track.bpm)}</td>\n\t\t\t\t\t\t\t\t<td>{`${['-', '', '+'][Math.sign(track.error) + 1]}${parseFloat(\n\t\t\t\t\t\t\t\t\t((Math.abs(track.error) / targetTempo) * 100).toFixed(1)\n\t\t\t\t\t\t\t\t)}%`}</td>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<Mp3Toggle url={track.preview} />\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t))}\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t)\n\t);\n}\n\nfunction App({ queryParams }) {\n\tconst [step, setStep] = useState(queryParams.access_token ? 1 : 0);\n\tconst [targetTempo, _setTargetTempo] = useState(150);\n\tconst [tracks, setTracks] = useState(null);\n\n\tuseEffect(() => {\n\t\tdocument.documentElement.style.setProperty(\n\t\t\t'--hue',\n\t\t\t16 + (1 - (targetTempo - 60) / (TEMPO_UPPER_BOUND - TEMPO_LOWER_BOUND)) * 200\n\t\t);\n\t}, [targetTempo]);\n\n\tconst setTargetTempo = useCallback(newTempo => {\n\t\tif (typeof newTempo === 'function') {\n\t\t\t_setTargetTempo(oldTempo => boundTempo(newTempo(oldTempo)));\n\t\t} else _setTargetTempo(boundTempo(newTempo));\n\t}, []);\n\n\tuseEffect(() => {\n\t\tif (queryParams.access_token) {\n\t\t\tsetTracks([]);\n\n\t\t\tconst Authorization = `${queryParams.token_type} ${queryParams.access_token}`;\n\t\t\tlet nextParams = '?limit=50';\n\t\t\t(async () => {\n\t\t\t\tconst processResponse = ({ next, items: tracks }) => {\n\t\t\t\t\tnextParams = next && next.slice(next.indexOf('?'));\n\n\t\t\t\t\ttracks.forEach(track => {\n\t\t\t\t\t\tfetch(`${SPOTIFY_API_ROUTE}/v1/audio-features/${track.id}`, {\n\t\t\t\t\t\t\theaders: { Authorization },\n\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.then(response => response.json())\n\t\t\t\t\t\t\t.then(features => {\n\t\t\t\t\t\t\t\tsetTracks(oldTracks => [\n\t\t\t\t\t\t\t\t\t...oldTracks,\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tid: track.id,\n\t\t\t\t\t\t\t\t\t\ttitle: track.name,\n\t\t\t\t\t\t\t\t\t\tartist: track.artists.map(a => a.name).join(', '),\n\t\t\t\t\t\t\t\t\t\tduration: msToTimestamp(track.duration_ms),\n\t\t\t\t\t\t\t\t\t\tbpm: features.tempo,\n\t\t\t\t\t\t\t\t\t\tpreview: track.preview_url,\n\t\t\t\t\t\t\t\t\t\turl: track.external_urls.spotify,\n\t\t\t\t\t\t\t\t\t\tfeatures,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\twhile (nextParams) {\n\t\t\t\t\tawait fetch(`${SPOTIFY_API_ROUTE}/v1/me/top/tracks${nextParams}`, {\n\t\t\t\t\t\theaders: { Authorization },\n\t\t\t\t\t})\n\t\t\t\t\t\t.then(response => response.json())\n\t\t\t\t\t\t.then(processResponse);\n\t\t\t\t}\n\t\t\t})();\n\t\t}\n\t}, [queryParams.access_token, queryParams.token_type]);\n\n\tconst { title, Main, Footer } = steps[step];\n\treturn (\n\t\t<div className=\"App\">\n\t\t\t<header className=\"Header\">\n\t\t\t\t<h1>{title}</h1>\n\t\t\t</header>\n\t\t\t<main>\n\t\t\t\t<Main targetTempo={targetTempo} setTargetTempo={setTargetTempo} tracks={tracks} />\n\t\t\t</main>\n\t\t\t<footer className=\"Footer\">\n\t\t\t\t<Footer setStep={setStep} />\n\t\t\t</footer>\n\t\t</div>\n\t);\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n\tif (onPerfEntry && onPerfEntry instanceof Function) {\n\t\timport('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n\t\t\tgetCLS(onPerfEntry);\n\t\t\tgetFID(onPerfEntry);\n\t\t\tgetFCP(onPerfEntry);\n\t\t\tgetLCP(onPerfEntry);\n\t\t\tgetTTFB(onPerfEntry);\n\t\t});\n\t}\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nconst queryParams = window.location.hash\n\t.slice(1)\n\t.split('&')\n\t.reduce((acc, pair) => {\n\t\tif (pair) {\n\t\t\tconst [key, value] = pair.split('=');\n\t\t\tacc[key] = decodeURIComponent(value);\n\t\t}\n\t\treturn acc;\n\t}, {});\nwindow.history.replaceState({}, document.title, window.location.pathname);\n\nReactDOM.render(\n\t<React.StrictMode>\n\t\t<App queryParams={queryParams} />\n\t</React.StrictMode>,\n\tdocument.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}